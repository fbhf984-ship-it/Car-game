<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turbo Lanes</title>
<style>
body { margin:0; font-family:sans-serif; background:#0e0f13; color:#fff; display:flex; flex-direction:column; align-items:center;}
canvas { background: linear-gradient(#1a1f2e,#0e111a); border:2px solid #fff; border-radius:10px;}
button { padding:8px 14px; margin:4px; border:none; border-radius:6px; background:#29d17d; color:#000; cursor:pointer;}
.overlay { position:absolute; top:0; left:0; right:0; bottom:0; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.7);}
.hidden { display:none;}
</style>
</head>
<body>

<h1>Turbo Lanes</h1>
<canvas id="game" width="480" height="640"></canvas>

<div class="overlay" id="startOverlay">
  <div>
    <h2>Turbo Lanes</h2>
    <button id="btnStart">Start</button>
  </div>
</div>

<div class="overlay hidden" id="gameOverOverlay">
  <div>
    <h2>Game Over</h2>
    <p>Score: <span id="finalScore">0</span></p>
    <button id="btnRestart">Restart</button>
  </div>
</div>

<div style="margin-top:8px;">
  <span>Score: <span id="score">0</span></span>
</div>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');

const startOverlay=document.getElementById('startOverlay');
const gameOverOverlay=document.getElementById('gameOverOverlay');
const btnStart=document.getElementById('btnStart');
const btnRestart=document.getElementById('btnRestart');
const scoreEl=document.getElementById('score');
const finalScoreEl=document.getElementById('finalScore');

const LANES=3;
const ROAD_W=canvas.width*0.6;
const ROAD_X=(canvas.width-ROAD_W)/2;
const LANE_W=ROAD_W/LANES;

const PLAYER_W=40, PLAYER_H=70;
const ENEMY_W=40, ENEMY_H=70;
const COIN_R=10;

let state={running:false,playerLane:1,playerY:canvas.height-100,score:0,enemies:[],coins:[],speed:4};

function laneX(l){return ROAD_X+l*LANE_W+LANE_W/2-PLAYER_W/2;}

function reset(){state.playerLane=1; state.playerY=canvas.height-100; state.score=0; state.enemies=[]; state.coins=[]; state.speed=4; scoreEl.textContent='0';}

function startGame(){reset();state.running=true;startOverlay.classList.add('hidden');gameOverOverlay.classList.add('hidden');}

function restartGame(){startGame();}

btnStart.onclick=startGame;
btnRestart.onclick=restartGame;

// Controls
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft') state.playerLane=Math.max(0,state.playerLane-1);
  if(e.key==='ArrowRight') state.playerLane=Math.min(LANES-1,state.playerLane+1);
});

// Touch controls for iPhone
canvas.addEventListener('touchstart',e=>{
  const touch=e.touches[0];
  const x=touch.clientX-canvas.getBoundingClientRect().left;
  if(x<canvas.width/2) state.playerLane=Math.max(0,state.playerLane-1);
  else state.playerLane=Math.min(LANES-1,state.playerLane+1);
});

// Spawn enemies/coins
let spawnTimer=0;
function spawn(dt){
  spawnTimer-=dt;
  if(spawnTimer<=0){
    const lane=Math.floor(Math.random()*LANES);
    if(Math.random()<0.7) state.enemies.push({lane:lane,x:laneX(lane),y:-ENEMY_H});
    else state.coins.push({lane:lane,x:laneX(lane)+PLAYER_W/2-COIN_R,y:-COIN_R*2,r:COIN_R});
    spawnTimer=1.2-Math.min(0.7,state.score/500);
  }
}

// Update
let last=0;
function loop(ts){
  const dt=(ts-last)/1000; last=ts;
  if(state.running){
    // move enemies
    for(const e of state.enemies) e.y+=state.speed;
    for(const c of state.coins) c.y+=state.speed;
    // remove offscreen
    state.enemies=state.enemies.filter(e=>e.y<canvas.height);
    state.coins=state.coins.filter(c=>c.y<canvas.height);
    // collision
    const px=laneX(state.playerLane);
    const py=state.playerY;
    for(const e of state.enemies){
      if(px<e.x+ENEMY_W && px+PLAYER_W>e.x && py<e.y+ENEMY_H && py+PLAYER_H>e.y){endGame(); return;}
    }
    for(const c of state.coins){
      if(px< c.x+COIN_R*2 && px+PLAYER_W>c.x && py< c.y+COIN_R*2 && py+PLAYER_H>c.y){state.score+=10; c.y=-100;}
    }
    state.score+=Math.floor(dt*10);
    scoreEl.textContent=state.score;
    spawn(dt);
  }
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

function endGame(){state.running=false; finalScoreEl.textContent=state.score; gameOverOverlay.classList.remove('hidden');}

// Draw car with details
function drawCar(x,y,w,h,color='blue'){
  // body
  ctx.fillStyle=color;
  ctx.fillRect(x,y,w,h);
  // windows
  ctx.fillStyle='lightblue';
  ctx.fillRect(x+5,y+10,w-10,20);
  // wheels
  ctx.fillStyle='black';
  ctx.fillRect(x-5,y+h-15,10,10);
  ctx.fillRect(x+w-5,y+h-15,10,10);
  ctx.fillRect(x-5,y+5,10,10);
  ctx.fillRect(x+w-5,y+5,10,10);
  // headlights
  ctx.fillStyle='yellow';
  ctx.fillRect(x+5,y-5,10,5);
  ctx.fillRect(x+w-15,y-5,10,5);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // road
  ctx.fillStyle='#222';
  ctx.fillRect(ROAD_X,0,ROAD_W,canvas.height);
  // lanes
  ctx.strokeStyle='#fff';
  ctx.lineWidth=2;
  ctx.setLineDash([20,20]);
  for(let i=1;i<LANES;i++){
    const x=ROAD_X+i*LANE_W;
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
  }
  ctx.setLineDash([]);
  // player
  drawCar(laneX(state.playerLane),state.playerY,PLAYER_W,PLAYER_H,'green');
  // enemies
  for(const e of state.enemies) drawCar(e.x,e.y,ENEMY_W,ENEMY_H,'red');
  // coins
  ctx.fillStyle='gold';
  for(const c of state.coins) ctx.beginPath(),ctx.arc(c.x+COIN_R,c.y+COIN_R,COIN_R,0,Math.PI*2),ctx.fill();
}
</script>
</body>
</html>
